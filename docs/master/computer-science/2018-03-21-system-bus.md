# 系统总线

## 总线

总线是连接多个部件的信息传输线，是各部件共享的传输介质，由许多传输线或通路组成，每条线可一位一位地传输二进制代码。在同一时刻，只允许一个部件向总线发送信息，允许多个部件从总线接受相同的信息。

## 总线分类

按数据传输方式可分为：并行传输总线和串行传输总线。

按连接部件不同可分为：

- 片内总线：芯片内部的总线。
- 系统总线：CPU、MM、I/O 各大部件之间的信息传输线。


按传输信息的不同，可分为：

* 数据总线：用来传输各功能部件之间的数据信息，双向传输，其位数（数据总线宽度）与机器字长、存储字长相关。
* 地址总线：主要用来指出数据总线上的源数据或目的数据在存储单元的地址或 I/O 设备的地址，其位数与存储单元个数相关。
* 控制总线：用来发出各种控制信号的传输线。常见的控制信号有：
  * 时钟：用来同步各种操作
  * 复位：初始化所有部件
  * 总线请求：表示某部件需要获得总线使用权
  * 总线允许：表示需要获得总线控制权的部件已获得控制权
  * 中断请求：表示某部件提出中断请求
  * 中断响应：表示中断请求已被接收
  * 存储器写：将数据总线上的数据写至存储器的指定地址单元内
  * 存储器读：将指定存储单元中的数据读到数据总线上
  * I/O 读：从指定的 I/O 端口将数据读到数据总线上
  * I/O 写：将数据总线上的数据输出到指定的 I/O 端口内
  * 传输响应：表示数据已被接收或已将数据送至数据总线上

- 通信总线：用于计算机系统之间或计算机系统与其他系统（如移动通信）之间的通信。


按传输方式可分为：

- 串行通信：数据在单条一位宽的传输线上，一位一位按低位到高位顺序分时传送
- 并行通信：数据在多条一位宽的传输线上，同时由源送到目的地（适宜近距离传输）


## 总线特性

* 机械特性：机械连接方式特性
* 电气特性：总线的每一根传输线上信号的传递方向和有效的电平范围，通常规定 CPU 发出的信号为输出信号
* 功能特性：总线中每根传输线的功能
* 时间特性：总线中的任一根传输线的有效时间段

## 总线性能指标

总线宽度：通常指数据总线的根数

总线带宽：单位时间内总线上传输数据的位数

时钟同步/不同步：数据与时钟同步工作与否

总线复用：一条信号线上分时传送两种信号

信号线数：地址总线、数据总线、控制总线总线数之和

负载能力：当总线接上负载后，总线输入输出的逻辑电平是否保持在正常的额定范围内

## 总线标准

系统与各模块、模块与模块之间的一个互连的标准界面（接口）。

|                       总线标准                       |                  参数                  |                           用途特点                           |
| :--------------------------------------------------: | :------------------------------------: | :----------------------------------------------------------: |
|       ISA （Industrial Standard Architecture）       |  8MHz，16MBps，16位数据线，32位地址线  |          所有数据传送必须通过 CPU 或 DMA 接口来管理          |
|                   EISA（Extended）                   |  8MHz，33MBps，32位数据线，32位地址线  | 从 CPU 中分离出总线控制权，支持多个总线控制器和突发方式（成块的数据传送）传输 |
|    VESA（Video Electronic Standard Association）     | 33MHz，133MBps，32位数据线，64位地址线 |           局部总线，用于 CPU 与 I/O 间高速数据交换           |
| PCI（Peripheral Component Interconnect）外围部件互连 |  33/66MHz，132/528MBps，32/64位数据线  | 不依赖于具体的处理器，支持 plug&play，支持多主设备，利用 PCI 桥路的多级缓冲实现与处理器/存储器子系统的安全并发操作 |
|     AGP（Accelerated Graphic Port）加速图形端口      |                                        |                      显卡专用的局部总线                      |
|            RS-232C（recommend Standard）             |                                        | 串行通信总线标准，用于串行二进制交换的数据终端设备（DTE）和数据通信设备（DCE）之间的标准接口 |
|       USB（Universal Serial Bus）通用串行总线        |                                        |                  plug&play，很强的连接能力                   |

## 总线结构



## 总线控制

### 总线判优控制

总线判优控制可分为集中式和分布式两种，前者的控制逻辑集中在一处，后者的控制逻辑分散在与总线连接的各个部件或设备上。常见的集中控制优先权仲裁方式有三种：

![](http://oohkn7mnd.bkt.clouddn.com/IMG_0241.JPG?imageView/2/w/450/q/90)

* 链式查询：部件通过 BR 发出**总线请求**，总线控制部件接收到请求(但不知道请求的来源)，**总线同意**信号通过 BG 传送给 I/O，若 BG 到达的接口有总线请求，BG 信号便不再往后传，该接口获得总线使用权，并建立总线忙 BS 信号。
* 计数器定时查询：总控制部件接收到由 BR 送来的总线请求信号后，在总线未被使用的情况下，计数器开始计数，并通过设备地址线向各设备发出一组地址信号。当某个请求占用总线的设备地址与计数值一致时，便获得总线的使用权，此时终止计数器查询。计数器查询中共用到 $\lceil log_2(设备数)\rceil $ 条控制线。
* 独立请求：总控制部件中有一排队电路，可依据优先次序确定相应请求的设备，共用到 2n 条控制线。

### 总线通信控制

总线通信控制的目的是解决通信双方协调配合问题。

通常完成一次总线操作的时间称为总线周期，分为四个阶段：**申请分配阶段、寻址阶段、传数阶段和结束阶段**。

![](http://oohkn7mnd.bkt.clouddn.com/IMG_20180321_151601.jpg?imageView/2/w/450/q/90)

#### 同步通信

通信双方由统一时钟标准控制数据传送。时标可以由 CPU 的总线控制部件或其他部件的时序发生器发出，但必须有总线控制部件发出的时钟信号对它们进行同步。优点：规定明确统一，模块间配合简单一致；缺点：必须按照速度最慢的部件来设计公共时钟。一般用于总线长度较短（考虑到距离最长的两个设备的传输延迟）、各部件存取时间比较一致的场合。

#### 异步通信

异步通信采用应答的方式，即当主模块发出请求信号时，一直等待从模块（应答线）反馈回来“响应”信号才开始通信。根据主模块发出信号后是否要接收到从模块回答信号才撤销请求、从模块发出回答信号是否必须贷获知主模块请求信号已撤销后再撤销其回答信号，分为不互锁、半互锁和全互锁。

异步通信可用于并行传送和串行传送，异步串行通信的数据传送速率用波特率（单位时间传送二进制数据的位数）来衡量。

#### 半同步通信

半同步通信与同步通信相比，增设了一条 $\overline {WAIT}$ 相应信号线，采用插入时钟周期的措施来协调，若从模块无法在 T3 时刻提供数据，则必须在 T3 时刻来临前给出 $\overline {WAIT}$ （低电平）信号通知主模块。

#### 分离式通信

以上三种通信方式中，从模块按照命令读取数据时，总线处于空闲状态。分离式通信克服了这种消极等待，将传输周期分为两个子周期。

* 第一个子周期：主模块 A 在获得总线使用授权命令后，将地址、命令以及其他信息（包括主模块编号），发到总线上，发送完便放弃总线使用权。
* 第二个子周期：当 B 模块收到 A 模块发来的有关命令信号后，经选择、读取、译码等一系列内部操作后，将数据准备好，申请总线使用权，获准后便将 A 模块的编号、B模块地址、数据等信息送到总线上。