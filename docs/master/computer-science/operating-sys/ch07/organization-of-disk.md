# 外存的组织形式

## 连续组织方式

为每个文件分配一组相邻的盘块，随着文件建立时空间的分配和文件删除时空间的回收，需要利用紧凑的方法将外存上的碎片紧凑到一起。

## 链接组织方式

### 隐式链接

在文件目录的每一个目录项中，都含有指向链接文件第一个盘块和最后一个盘块的指针。磁盘的每一盘块都有指向下一个盘块的指针，即把各盘块的链接放在磁盘中。

### 显式链接

显式链接指把用于链接文件各物理块的指针放在内存的一张链接表（即文件分配表 File Allocation Table FAT）中，将属于某一文件的第一个盘块号作为文件地址被填入相应文件的 FCB 的「物理地址」字段中。

### FAT 技术

FAT 引入「卷」的概念，支持将一个物理磁盘分成四个逻辑磁盘，每个逻辑磁盘就是一个卷（分区），能够被单独格式化和供文件系统分配空间时使用。一个卷中包含了文件系统信息（目录、FAT 表和逻辑驱动器字母）、一组文件和空闲空间。

在 FATX 系列中，每个表项占 X 位，每个簇有 N 个盘块，每个盘块大小为 M（512B），则 FATX 可管理的最大分区空间为 $$2^X \cdot N \cdot M$$  

### NTFS 技术

NTFS 是以簇作为磁盘空间分配和回收的基本单位，一个文件占有若干个簇，一个簇只属于一个文件。一个卷中的所有文件信息、目录信息和可用的未分配空间信息，都以文件记录的方式记录在一张主控文件表 MFT（Master File Table）中，卷中的每个文件（包括 MFT）作为一条记录，在 MFT 表中占有一行，每行称为该行所对应文件的元数据（或文件控制字）。

当文件较小时，其属性值所占空间也较小，可以将文件的所有属性直接记录在元数据中；当文件较大时，元数据仅能记录文件的一部分属性，其余属性记录到卷中是其他可用簇中，并将这些簇按其所记录文件的属性进行分类，分别链接称多个队列，并将指向这些队列的指针保存在元数据中。

## 索引组织方式

### 单级索引组织方式

单级索引组织方式为每个文件分配一个索引块，把分配给该文件的所有盘块号都记录在该索引块中，在建立一个文件时，只需在为之建立的目录项中填上指向该索引块的指针。

当一个文件的所有块太大时，可以采用多级索引组织方式，为一级索引块建立索引块。

### 增量式索引组织方式

为全面照顾小、中、大及特大型作业，可采用多种组织方式来构建文件的物理结构。

- 对于小文件（小于十个盘块），最好将每个盘块的地址都直接放入 FCB（或索引节点）中，可直接寻址。
- 对于中文件（10~100个盘块），可采用单级索引组织。
- 对于大型和特大型，可采用多级索引组织。

## ChangeLog

> 2018.09.24 初稿

